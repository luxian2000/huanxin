# QAE083.py 修改说明

## 修改概述

本次修改主要是将 [QAE083.py](QAE083.py) 从使用本地 `.npy` 数据集改为使用 CsiNet 格式的 `.mat` 数据集。

## 主要修改内容

### 1. 数据源变更

**原数据源**:
- 路径: `/Users/luxian/DataSpace/csi_cmri/CSI_channel_30km.npy`
- 形状: `(80000, 2560)`
- 维度: 2560维

**新数据源**:
- 训练数据: `/Users/luxian/DataSpace/csinet/data/DATA_Htrainin.mat`
- 验证数据: `/Users/luxian/DataSpace/csinet/data/DATA_Hvalin.mat`  
- 测试数据: `/Users/luxian/DataSpace/csinet/data/DATA_Htestin.mat`
- 形状: 训练(100000, 2048), 验证(30000, 2048), 测试(20000, 2048)
- 维度: 2048维

### 2. 网络架构调整

为了适配新的数据维度，对网络参数进行了相应调整：

| 参数 | 原值 | 新值 | 说明 |
|------|------|------|------|
| INPUT_DIM | 2560 | 2048 | 输入维度调整 |
| ENCODED_DIM | 256 | 512 | 编码维度调整 |
| DATA_QUBITS | 8 | 9 | 量子比特数调整 |
| OUTPUT_DIM | 2560 | 2048 | 输出维度调整 |

### 3. 数据预处理优化

新增了标准的数据预处理流程：
- 数据类型转换为 `float32`
- 数据归一化到 `[0,1]` 范围（符合CsiNet标准）
- 添加了数据范围验证

### 4. 激活函数调整

- 经典编码器输出层：`Tanh()` → 输出范围 `[-1, 1]`
- 经典解码器输出层：`Sigmoid()` → 输出范围 `[0, 1]`（匹配预处理后的数据）

### 5. 训练参数优化

针对新数据集特点调整了训练参数：
- 批量大小：20 → 32
- 训练样本数：1000 → 2000（或更少，取决于可用内存）
- 验证样本数：500 → 200
- 测试样本数：500 → 500
- 训练轮数：120 → 100

### 6. 评估指标增强

新增了NMSE（归一化均方误差）计算：
```python
# 计算NMSE（归一化均方误差）
power = torch.sum(subset ** 2, dim=1)
mse_per_sample = torch.sum((outputs - subset) ** 2, dim=1)
nmse = 10 * torch.log10(torch.mean(mse_per_sample / power))
```

## 文件变更列表

1. **主文件**: `QAE083.py` - 核心修改文件
2. **测试文件**: `test_qae083_data_loading.py` - 数据加载测试脚本
3. **文档**: `QAE083_modifications.md` - 本说明文档

## 验证结果

✅ 数据加载测试成功
- 训练数据形状: (100000, 2048)
- 验证数据形状: (30000, 2048)
- 测试数据形状: (20000, 2048)
- 数据范围: [0.0, 1.0]（已归一化）

## 注意事项

1. 确保指定的 `.mat` 数据文件路径存在且可访问
2. 由于数据维度从2560降至2048，量子比特数从8增加到9
3. 建议在训练前先运行测试脚本验证数据加载功能
4. 可根据实际硬件资源调整批量大小和训练样本数

## 性能预期

相比原版本，新版本应该具有：
- 更快的训练速度（数据维度降低）
- 更好的内存利用率
- 与CsiNet标准方法更一致的比较基准
- 更准确的性能评估（增加了NMSE指标）